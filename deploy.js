const Web3 = require('web3');
//const web3 = new Web3('https://ropsten.infura.io/y07GHxUyTgeN2mdfOonu');
const web3 = new Web3('wss://ropsten.infura.io/ws');

async function deploy() {
  const contract = new web3.eth.Contract([{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"deals","outputs":[{"name":"initiator","type":"address"},{"name":"receiver","type":"address"},{"name":"tokenAddress","type":"address"},{"name":"amount","type":"uint256"},{"name":"claimUntilBlock","type":"uint256"},{"name":"state","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"etomicRelay","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_dealId","type":"uint256"},{"name":"_etomicTxId","type":"bytes32"}],"name":"receiverClaimsPayment","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_dealId","type":"uint256"},{"name":"_receiver","type":"address"},{"name":"_tokenAddress","type":"address"},{"name":"_amount","type":"uint256"}],"name":"initErc20Deal","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_dealId","type":"uint256"}],"name":"confirmDeal","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_dealId","type":"uint256"}],"name":"approveDeal","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_dealId","type":"uint256"}],"name":"initiatorClaimsPayment","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_dealId","type":"uint256"},{"name":"_receiver","type":"address"}],"name":"initEthDeal","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"blocksPerDeal","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_etomicRelay","type":"address"},{"name":"_blocksPerDeal","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"dealId","type":"uint256"},{"indexed":true,"name":"etomicTxId","type":"bytes32"}],"name":"NeedDealApprove","type":"event"}]);

  const deploy = contract.deploy({
    data: '0x6060604052341561000f57600080fd5b6040516040806116228339810160405280805190602001909190805190602001909190505081600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508060028190555050506115958061008d6000396000f300606060405260043610610099576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806303988f841461009e578063081ab58d1461018a5780632c26a436146101df57806332b4fa9a1461020f5780635cb442bb146102795780635f9d8efb1461029c5780636d58b221146102bf57806392aab70f146102e2578063cd73d26c14610319575b600080fd5b34156100a957600080fd5b6100bf6004808035906020019091905050610342565b604051808773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200184815260200183815260200182600381111561017157fe5b60ff168152602001965050505050505060405180910390f35b341561019557600080fd5b61019d6103eb565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156101ea57600080fd5b61020d600480803590602001909190803560001916906020019091905050610411565b005b341561021a57600080fd5b610277600480803590602001909190803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001909190505061051a565b005b341561028457600080fd5b61029a6004808035906020019091905050610a21565b005b34156102a757600080fd5b6102bd6004808035906020019091905050610d68565b005b34156102ca57600080fd5b6102e0600480803590602001909190505061109f565b005b610317600480803590602001909190803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061137d565b005b341561032457600080fd5b61032c611563565b6040518082815260200191505060405180910390f35b60006020528060005260406000206000915090508060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060030154908060040154908060050160009054906101000a900460ff16905086565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6001600381111561041e57fe5b60008084815260200190815260200160002060050160009054906101000a900460ff16600381111561044c57fe5b14801561046d57506000808381526020019081526020016000206004015443105b80156104d9575060008083815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b15156104e457600080fd5b8060001916827ffceec3202d841908d7b11c314523e4c8c652da17eba32d2c4ddae1d9c8e4b09a60405160405180910390a35050565b6000808473ffffffffffffffffffffffffffffffffffffffff1614158015610559575060008373ffffffffffffffffffffffffffffffffffffffff1614155b80156105655750600082115b80156105a957506000600381111561057957fe5b60008087815260200190815260200160002060050160009054906101000a900460ff1660038111156105a757fe5b145b15156105b457600080fd5b600160008087815260200190815260200160002060050160006101000a81548160ff021916908360038111156105e657fe5b02179055503360008087815260200190815260200160002060000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508360008087815260200190815260200160002060010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508260008087815260200190815260200160002060020160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508160008087815260200190815260200160002060030181905550600254430160008087815260200190815260200160002060040181905550829050600080868152602001908152602001600020600301548173ffffffffffffffffffffffffffffffffffffffff1663dd62ed3e33306000604051602001526040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200192505050602060405180830381600087803b151561080f57600080fd5b6102c65a03f1151561082057600080fd5b505050604051805190501015801561090a5750600080868152602001908152602001600020600301548173ffffffffffffffffffffffffffffffffffffffff166370a08231336000604051602001526040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b15156108ec57600080fd5b6102c65a03f115156108fd57600080fd5b5050506040518051905010155b151561091557600080fd5b8073ffffffffffffffffffffffffffffffffffffffff166323b872dd3330856000604051602001526040518463ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019350505050602060405180830381600087803b15156109f457600080fd5b6102c65a03f11515610a0557600080fd5b505050604051805190501515610a1a57600080fd5b5050505050565b600060016003811115610a3057fe5b60008084815260200190815260200160002060050160009054906101000a900460ff166003811115610a5e57fe5b148015610acb575060008083815260200190815260200160002060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b8015610aeb57506000808381526020019081526020016000206004015443105b1515610af657600080fd5b600260008084815260200190815260200160002060050160006101000a81548160ff02191690836003811115610b2857fe5b0217905550600080600084815260200190815260200160002060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161415610c105760008083815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc600080858152602001908152602001600020600301549081150290604051600060405180830381858888f193505050501515610c0b57600080fd5b610d64565b60008083815260200190815260200160002060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690508073ffffffffffffffffffffffffffffffffffffffff1663a9059cbb60008085815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600080868152602001908152602001600020600301546000604051602001526040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b1515610d3d57600080fd5b6102c65a03f11515610d4e57600080fd5b505050604051805190501515610d6357600080fd5b5b5050565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610dc657600080fd5b60016003811115610dd357fe5b60008084815260200190815260200160002060050160009054906101000a900460ff166003811115610e0157fe5b148015610e2257506000808381526020019081526020016000206004015443105b1515610e2d57600080fd5b600260008084815260200190815260200160002060050160006101000a81548160ff02191690836003811115610e5f57fe5b0217905550600080600084815260200190815260200160002060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161415610f475760008083815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc600080858152602001908152602001600020600301549081150290604051600060405180830381858888f193505050501515610f4257600080fd5b61109b565b60008083815260200190815260200160002060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690508073ffffffffffffffffffffffffffffffffffffffff1663a9059cbb60008085815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600080868152602001908152602001600020600301546000604051602001526040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b151561107457600080fd5b6102c65a03f1151561108557600080fd5b50505060405180519050151561109a57600080fd5b5b5050565b6000600160038111156110ae57fe5b60008084815260200190815260200160002060050160009054906101000a900460ff1660038111156110dc57fe5b1480156110fe5750600080838152602001908152602001600020600401544310155b801561116a575060008083815260200190815260200160002060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b151561117557600080fd5b600360008084815260200190815260200160002060050160006101000a81548160ff021916908360038111156111a757fe5b0217905550600080600084815260200190815260200160002060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16141561125a573373ffffffffffffffffffffffffffffffffffffffff166108fc600080858152602001908152602001600020600301549081150290604051600060405180830381858888f19350505050151561125557600080fd5b611379565b60008083815260200190815260200160002060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690508073ffffffffffffffffffffffffffffffffffffffff1663a9059cbb33600080868152602001908152602001600020600301546000604051602001526040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b151561135257600080fd5b6102c65a03f1151561136357600080fd5b50505060405180519050151561137857600080fd5b5b5050565b60008173ffffffffffffffffffffffffffffffffffffffff16141580156113a45750600034115b80156113e85750600060038111156113b857fe5b60008084815260200190815260200160002060050160009054906101000a900460ff1660038111156113e657fe5b145b15156113f357600080fd5b600160008084815260200190815260200160002060050160006101000a81548160ff0219169083600381111561142557fe5b02179055503360008084815260200190815260200160002060000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508060008084815260200190815260200160002060010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600080600084815260200190815260200160002060020160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555034600080848152602001908152602001600020600301819055506002544301600080848152602001908152602001600020600401819055505050565b600254815600a165627a7a723058208fabf8c14bbf16eb12728a79ebe9ed5ba16fbde314d329fd88425ac00215dfdd0029',
    arguments: [
      '0x1120254C730D6edF0B3f9b4a79f78Bf634F0A782',
      200,
    ]
  });

  const txInput = {
    to: null,
    amount: '0',
    gas: (await deploy.estimateGas()) + 300000,
    gasPrice: web3.utils.toWei('100', 'gwei'),
    data: deploy.encodeABI()
  };

  return new Promise((resolve, reject) => {
    web3.eth.accounts.signTransaction(txInput, '0x10865c7c1046fc14437b96a45e83c4e768d1875aa5409c2b2d5f65b5e5dbcb91').then(transaction => {
      web3.eth.sendSignedTransaction(transaction.rawTransaction)
        .on('transactionHash', transactionHash => {
          resolve(transactionHash);
        })
        .on('error', (error) => {
          reject(error);
        })
        .catch((error) => {
          reject(error);
        }).then((receipt) => {
          console.log('contract deployed');
          console.log(receipt);
        });
    });
  });
}

deploy().then((hash) => {
  console.log(`finished: ${ hash }`);
});